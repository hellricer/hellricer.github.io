<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Genes in Middle-Earth | ~hellricer/</title>
<meta name="description" content="— a terminal dweller">
<meta name="keywords" content="gedcom, tolkien, arda, middle-earth, genealogy">

<link href="https://hellricer.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="~hellricer/ Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="https://hellricer.github.io/assets/css/main.min.css">
<!-- Webfonts -->
<script src="//use.edgefonts.net/source-sans-pro:n2,i2,n3,i3,n4,i4,n6,i6,n7,i7,n9,i9;source-code-pro:n4,n7;volkhov.js"></script>

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="https://hellricer.github.io/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Load highlight.js -->
<link rel="stylesheet" href="https://hellricer.github.io/assets/css/styles/googlecode.css">
<script src="https://hellricer.github.io/assets/js/vendor/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="https://hellricer.github.io/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="https://hellricer.github.io/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="https://hellricer.github.io/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://hellricer.github.io/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://hellricer.github.io/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://hellricer.github.io/images/apple-touch-icon-144x144-precomposed.png">
</head>

<body id="page">

<div class="navigation-wrapper">
    <nav role="navigation" id="site-nav">
        <div class="main-nav">
            
            <span class="nav-item">
                
                    <a href="https://hellricer.github.io/"><span class="nav-icon">✎</span> Posts</a>
                 
            </span>
            
            <span class="nav-item">
                
                    <a href="https://hellricer.github.io/projects.html"><span class="nav-icon">⚙</span> Projects</a>
                 
            </span>
            
            <span class="nav-item">
                
                    <a href="https://hellricer.github.io/about.html"><span class="nav-icon">☆</span> About</a>
                 
            </span>
            
            <span class="nav-item"><a href="https://hellricer.github.io/feed.xml" title="Atom/RSS feed"><span class="nav-icon">☰</span> Feed</a></span>
        </div>
    </nav>
</div><!-- /.navigation-wrapper -->


    
    <header class="masthead"></header><!-- /.masthead -->
    


<div id="main" role="main">
  <article class="entry">
    <img src="https://hellricer.github.io/assets/images/genes/head.png" class="entry-feature-image" alt="Genes in Middle-Earth" style="margin-top:0;">
    <div class="entry-wrapper">
      <header class="entry-header">
        <h1 class="entry-title">Genes in Middle-Earth</h1>
      </header>
      <div class="entry-content">
        
<p class="meta">
  <small>
    <em>[April 30, 2015]</em>
  </small>
</p>

<div class="post">
  <p><em>...one script to find them all,
and into GEDCOM bind them...</em></p>
<p>I love Middle-Earth.  Out of all the imaginary places invented for the entertainment, <em>Arda</em> is arguably
the most complex one.  The amount of information that accompanies the stories is overwhelming.  Tolkien is known
to be genius linguist - languages of his world evolve in time, fork into dialects and influence each other.
But his sense for geography and history is just as incredible.  There are more than 70 kingdoms with several hundreds of
people documented at least to some extent.  Some can be find in family trees printed in appendices of the books, some
family relations are only mentioned in stories, but there's lot of them.  So, how about we map them?</p>
<p>I'm obviously not the first one to think of digitalizing Tolkien's genealogies.  <a href="http://www.minastirith.com/cgi-bin/ultimatebb.cgi?ubb=get_topic;f=1;t=000070">There are</a>
some ancient forum threads that dealt with digitalizing the hobbit family trees with <a href="http://homepages.rootsweb.ancestry.com/~pmcbride/gedcom/55gctoc.htm">GEDCOM</a>.
But the GEDCOM files themselves were probably lost in time.</p>
<p>Few years ago Mr. Emil Johansson stirred up the waves when he came up with his amazing <a href="http://lotrproject.com">lotrproject.com</a>.
It's definitely the place to go if you want to get immersed in family trees, maps, statistics and lots of other stuff.
But the thing is that in the end it's "just" a website.  The actual data are stored in mysql database, but as an end-user the HTML
"render" is all you got.  <em>(Note: also, there are more than a few factual errors with his tree, which I reported to him.).</em>
You can do much more with the GEDCOM!  All the genealogy programs I've seen support import/export to it
and even software libraries exist for several languages.  Plus, you can start querying the data for less trivial questions like
common ancestors of individuals, distance from the root, etc.</p>
<h2>Crawling people</h2>
<p>The data were extracted from the <a href="http://tolkiengateway.net">tolkiengateway.net</a> which is both most comprehensive &amp; sourced
Tolkien wiki out there.  There is an <a href="http://en.wikipedia.org/wiki/Help:Infobox">infobox</a> for nearly all individuals which
consists of structured information about names, birth and death dates, gender and mainly - children &amp; parents.<br />
So I whipped out this Groovy script which starts on given individuals and crawls the tree of their descendants <a href="http://en.wikipedia.org/wiki/Breadth-first_search">breadth-first</a>:</p>
<hr>

<pre><code>package info.childcrawler;

def queue = new LinkedList&lt;String&gt;(["Marach", "Bëor", "Haldad"])
while (!queue.isEmpty()) {
    def wikiTitle = queue.remove()

    def infoBox
    if (new File(directory + wikiTitle).exists()) {
        println "Processing ${wikiTitle}"
        // convert the infobox to Map&lt;String, String&gt;
        infoBox = WikiInfoboxParser.getInfoBoxFromFile(new File(directory + wikiTitle))
    } else {
        println "Requesting ${wikiTitle}"
        infoBox = WikiInfoboxParser.getInfoBoxFromWiki(wikiTitle)
        new File(directory + wikiTitle).withWriter { out -&gt;
            infoBox.each { entry -&gt;
                out.println "${entry.key}=${entry.value}"
            }
        }
        Thread.sleep(20000)  // let's not spam the server
    }
    if (infoBox["spouse"]) {
        def spouses = WikiInfoboxParser.decodeLinks(infoBox["spouse"])
        for (String spouse : spouses) {
            // prevent the loop
            if (!new File(directory + spouse).exists()) {
                queue.add(spouse)
            }
        }
    }
    if (infoBox["children"]) {
        queue.addAll(WikiInfoboxParser.decodeLinks(infoBox["children"]))
    }
    Thread.sleep(100)
}
</code></pre>
<hr>

<p>Now we just have to find all individuals without a parent to capture the whole thing.  (<em>lotrproject.com</em> helped a big deal here).
If you miss, someone, you can always re-run it - the script doesn't download already downloaded data again.
The problem here is that the infoboxes, however structured, are still meant for humans so there are some things that need
to be considered.  For instance, <a href="http://tolkiengateway.net/wiki/Maglor">Maglor</a> has Elrond and Elros listed as his
children, even though he just fostered them.  Also individuals with multiple families cause problems with this simple approach.
To work around it, you'd have to check both parents of all children to find out which family they belong to.
Because <a href="http://tolkiengateway.net/wiki/Finw%C3%AB">Finwë</a> is only guy with two wifes, I resolved this case manually...</p>
<h2>Building the tree</h2>
<p>Now that we have the data downloaded, we can start constructing the GEDCOM tree.  I decided to do it in three steps:</p>
<ol>
<li>put every individual into the tree (without any relations),</li>
<li>for every individual with spouse, create (or update existing spouse's) family + check for non-existing parents &amp; siblings,</li>
<li>for every individual with children, create (or update existing) family.</li>
</ol>
<p>This means that I have to go through all individuals three times, but the fact I don't have to travel individuals in
any special order makes building the tree so much easier than building it from the top or the bottom.
The second step informs me if the crawling script missed someone (which is useful for finding the individuals I overlooked).</p>
<h2>Playing with our toy</h2>
<p>Alright, we have the complete tree so now we can start to play!  The reason I used Groovy for this project is the Java library
<a href="http://gedcom4j.org/main/">gedcom4j</a> which is IMHO the most mature GEDCOM implementation.  It's mainly the parser
and builder, but it also features some tool classes - like the AncestorCalculator.  This snippet finds all married couples
that have a common ancestor and displays the number of generations between them:</p>
<hr>

<pre><code>def gp = new GedcomParser()
def ac = new AncestryCalculator()
gp.load("/arda.ged")
def g = gp.gedcom

for (Family f : g.families.values()) {
    if (f.husband != null &amp;&amp; f.wife != null) {
        Set&lt;Individual&gt; common = ac.getLowestCommonAncestors(f.husband, f.wife)

        if (!common.isEmpty()) {
            def anc = common[0]
            println "${f.husband.names[0].basic} and ${f.wife.names[0].basic} have a common ancestor: ${anc.names[0].basic}"
            println "\t Generations from husband: " + ac.getGenerationCount(f.husband, anc)
            println "\t Generations from wife: " + ac.getGenerationCount(f.wife, anc)
            println ""
        }
    }
}
</code></pre>
<hr>

<p>This shows us all cases of inbreeding in Middle-Earth - <a href="http://tolkiengateway.net/wiki/Túrin">Túrin</a> &amp;
<a href="http://tolkiengateway.net/wiki/Nienor">Nienor</a> (which was unintentional) and <a href="http://tolkiengateway.net/wiki/Ar-Pharazôn">Ar-Pharazôn</a>
&amp; <a href="http://tolkiengateway.net/wiki/Tar-Míriel">Tar-Míriel</a> are the worst, but there are many others.
The famous case of <a href="http://tolkiengateway.net/wiki/Aragorn">Aragorn</a> and <a href="http://tolkiengateway.net/wiki/Arwen">Arwen</a> shows us that while
their common is ancestor is grandfather or Arwen, there are 56 generations between him and Aragorn:</p>
<figure>
    <a href="https://hellricer.github.io//assets/images/genes/aragorn-arwen.png"><img src="https://hellricer.github.io//assets/images/genes/aragorn-arwen.png" alt=" Image: " title="Relation between Aragorn and Arwen (created with GenealogicaGraphica)" /></a>
    <figcaption>Relation between Aragorn and Arwen (created with GenealogicaGraphica)</figcaption>
</figure>

<p>This might look like I'm trying to dig up some dirt on our favorite heroes, but the reason these relations are important
starts to be obvious once we notice that they meant a lot to Tolkien.  Already mentioned Túrin and his cousin Tuor were two of the greatest
heroes of the ancient times and it's not coincidence that their births were the fusion of all three <a href="http://tolkiengateway.net/wiki/Edain#The_Three_Houses">Houses of Edain</a>:</p>
<figure>
    <a href="https://hellricer.github.io//assets/images/genes/turin-tuor.png"><img src="https://hellricer.github.io//assets/images/genes/turin-tuor.png" alt=" Image: " title="Badass-ness visualised" /></a>
    <figcaption>Badass-ness visualised</figcaption>
</figure>

<p>Tuor's son Eärendil further improved on this by adding elvish (and even <a href="http://tolkiengateway.net/wiki/Melian">Ainur</a>) blood into the man's for the first time.
It's sad that we don't know more about Aragorn's son Eldarion, because he also represents the union between Three Houses of Edain and the eldar blood of House of Finarfin (through Arwen's grandma Galadriel).</p>
<p>Some free programs that support GEDCOM are <a href="http://sourceforge.net/projects/genj/">Genj</a>, <a href="http://gramps-project.org/">Gramps</a> &amp; <a href="http://www.ancestris.org/">Ancestris</a>.
Apart from that there are some PHP-based viewers, tools for creating trees in Wikimedia markup, etc.
There's lot to play with, so <a href="http://github.com/RobSis/middle-earth-genealogy-project">get the data</a> and happy hacking!</p>
</div>

<small><em>Thanks for stopping by!</em></small>
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2019 | <a href="http://github.com/hellricer">hellricer</a></span>

<div class="social-icons">
    <a href="https://pgp.mit.edu/pks/lookup?op=vindex&search=0x1025243C08203CF0" title="Email of hellricer" target="_blank"><i class="icon-envelope icon-2x"></i></a>
    <a href="http://github.com/hellricer" title="hellricer on Github" target="_blank"><i class="icon-github icon-2x"></i></a>
    
    
    
    
    
    
    
    
</div><!-- /.social-icons -->
    <div class="to-top"><a class="scroll" href="#page"><i class="icon-angle-up icon-2x"></i></a></div>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="https://hellricer.github.io/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="https://hellricer.github.io/assets/js/scripts.min.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/gist-embed/1.9/gist-embed.min.js"></script>

</body>
</html>